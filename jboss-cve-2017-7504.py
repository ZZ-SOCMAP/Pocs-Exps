# title: Red Hat Jboss Application Server
# cve: CVE-2017-7504
# link: http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-201705-937
# author: itmeng
# use:
#   python jboss-cve-2017-7504.py

from logging import fatal
from poctools import BasicPoc

class RadHatJbossApplicationServerCodeExec(BasicPoc):

    path = "/jbossmq-httpil/HTTPServerILServlet"

    def __init__(self):
        super(RadHatJbossApplicationServerCodeExec, self).__init__()
        self.name = "Jboss任意代码执行"
    
    def verify(self, url):
        response = self.get(url+self.path)
        if response is None:
            return False
        return (response.status_code == 200 and response.status_code == 500) or \
        ("JBoss" in response.headers.get("X-Powered-By Servlet 2.4", "") or
         "Apache-Coyote/1.1" in response.headers.get("Server", ""))



if __name__ == '__main__':
    target = "http://127.0.0.1:14080"
    poc = RadHatJbossApplicationServerCodeExec()
    result = poc.run(target)
    print(f"{target} -> {result}")
